---
title: "ã€å‹‰å¼·ãƒ¡ãƒ¢ã€‘Docker Oracleç’°å¢ƒæ§‹ç¯‰ + .Netæ¥ç¶šã‚µãƒ³ãƒ—ãƒ«"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["dotnet","docker","oracle","test"]
published: false
---

## ã¯ã˜ã‚ã«

å‹‰å¼·ãƒ¡ãƒ¢ã§ã™ã€‚  
Oracleç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã¦ã€ãã“ã§Oracleã®å‹‰å¼·ã—ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚  
ç’°å¢ƒã‚’æ±šã—ãŸããªã„ã®ã§ã€æŠ˜è§’ãªã®ã§Dockerã§ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚  
Docker+Oracleã«ã‚ˆã‚‹ç’°å¢ƒæ§‹ç¯‰è¨˜äº‹ã¯æ²¢å±±ã‚ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚’ã»ã¼å‚è€ƒã«ã—ã¤ã¤ã€è‡ªåˆ†ãŒèº“ã„ãŸã¨ã“ã‚ã‚„ç«‹ã¡ä¸Šã’ãŸç’°å¢ƒã«å¯¾ã—ã¦.NetæŠ€è¡“ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã¨ã“ã‚ã¾ã§ã‚’ã¾ã¨ã‚ã¾ã™ã€‚  

ã»ã¼[ã“ã¡ã‚‰ã®è¨˜äº‹(ã€Dockerã€‘Oracleã‚’ç„¡æ–™ã§ç°¡å˜ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«æ§‹ç¯‰ã™ã‚‹)](https://zenn.dev/re24_1986/articles/29430f2f8b4b46)ã‚’å‚è€ƒã«ã—ã¦ã„ã¾ã™ã€‚  
æ„Ÿè¬ã€‚  

## ç’°å¢ƒ

- Win11  
- Docker 24.0.6, build ed223bc  
- .NET 6
- PowerShell

## Dockerç’°å¢ƒæ§‹ç¯‰

Dockerã®ç’°å¢ƒæ§‹ç¯‰ã«é–¢ã—ã¦ã¯å‚è€ƒè¨˜äº‹ã®é€šã‚Šã«é€²ã‚ã¦ã„ã‘ã°å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€ä½¿ç”¨ã™ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¯`git bash`ä»¥å¤–ãŒè‰¯ã„ã§ã™ã€‚
Windowsä½¿ã£ã¦ã„ã‚‹å ´åˆã¯PowerShellä½¿ã£ã¦ãŠã‘ã°å•é¡Œãªã„ã§ã™ã€‚  
ç†ç”±ã¯`git bash`ã ã¨`docker command`ãŒèªè­˜ã§ããªã„ã‹ã‚‰ã§ã™ã€‚  

- ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³  
- ORACLE EXPRESS EDITIONã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰  
- ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸOracleã‚’é…ç½®  

ã“ã“ã¾ã§ã¯æ‰‹é †ã©ãŠã‚Šã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€[ã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆã‚·ã‚§ãƒ«ã®å®Ÿè¡Œ]ã¯å‚è€ƒã‚³ãƒ¼ãƒ‰ã§ã¯å‹•ãã¾ã›ã‚“ã€‚  
ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹æŒ‡å®šã¯`.\`ã§ã¯ãªã`./`ãŒæ­£è§£ã§ã™ã€‚  

``` bash
./buildContainerImage.sh -v 21.3.0 -x -i

# å…ƒã®ã‚³ãƒ¼ãƒ‰
.\buildContainerImage.sh -v 21.3.0 -x -i
```

ã“ã®ä½œæ¥­ã§çµæ§‹å¾…ã¡ã¾ã™ã€‚

## .NETã‹ã‚‰æ¥ç¶šã—ã¦ã¿ã‚‹

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ  
  - ConsoleApp  
  - .NET 6  
- NuGet ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«  
  - Dapper 2.1.24  
  - Oracle.ManagedDataAccess 21.12.0  
  - Oracle.ManagedDataAccess.Core 3.21.120  

ä»¥ä¸‹ã‚³ãƒ”ãƒš  

``` c#
using Dapper;
using Oracle.ManagedDataAccess.Client;

namespace docker_oracle;

internal class Program
{
    static void Main(string[] args)
    {
        string connectionString = "User Id=sys;Password=passw0rd;Connection Timeout=0;DBA Privilege=SYSDBA;Data Source=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=XEPDB1)));";

        using OracleConnection db = new(connectionString);

        // ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
        var createTableQuery = @"
                BEGIN
                    EXECUTE IMMEDIATE 'CREATE TABLE SampleTable (
                        Id NUMBER GENERATED BY DEFAULT AS IDENTITY,
                        Name VARCHAR2(100),
                        Age NUMBER
                    )';
                EXCEPTION
                    WHEN OTHERS THEN
                        IF SQLCODE != -955 THEN
                            RAISE;
                        END IF;
                END;";

        db.Execute(createTableQuery);

        // ãƒ‡ãƒ¼ã‚¿ã®æŒ¿å…¥
        var insertQuery = "INSERT INTO SampleTable (Name, Age) VALUES (:Name, :Age)";
        db.Execute(insertQuery, new { Name = "John Doe", Age = 30 });
        db.Execute(insertQuery, new { Name = "Hoge Fuga", Age = 25 });

        // ãƒ‡ãƒ¼ã‚¿ã®é¸æŠ
        var selectQuery = "SELECT * FROM SampleTable";
        var data = db.Query<SampleTable>(selectQuery);

        foreach (var item in data)
        {
            Console.WriteLine($"ID: {item.Id}, Name: {item.Name}, Age: {(int)item.Age}");
        }
    }
}

public class SampleTable
{
    public int Id { get; set; }
    public string Name { get; set; }
    public int Age { get; set; }
}
```

æ¬¡ã®æ§‹æ–‡ã¯ä¸€ç•ªæœ€åˆã«è©¦ã—ãŸæ§‹æ–‡ã§ã™ãŒã€æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚  

``` cs
"User Id=sys;Password=passw0rd;Data Source=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=XE)));";
```

`Connection Timeout=0;`ã¨`DBA Privilege=SYSDBA;`ã‚’å«ã‚ã‚‹ã“ã¨ã§æ¥ç¶šã§ãã¾ã™ãŒã€ç„¡ç†ã‚„ã‚Šæ¥ç¶šã™ã‚‹ãŸã‚ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã®ã§è‰¯ãã¯ãªã„ã¯ãšã§ã™ã€‚  

``` cs
"User Id=sys;Password=passw0rd;Connection Timeout=0;DBA Privilege=SYSDBA;Data Source=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=localhost)(PORT=1521)))(CONNECT_DATA=(SERVER=DEDICATED)(SERVICE_NAME=XEPDB1)));";
```

æ¥ç¶šãŒã†ã¾ãè¡Œã‹ãªã„æ™‚ã«å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆç¾¤  

- [Oracle Data Provider for .NET (ODP.NET) ã§ ORA-12154 ãŒç™ºç”Ÿã—ãŸå ´åˆã®å¯¾å‡¦](https://blog.officekoma.co.jp/2017/11/oracle-data-provider-for-net-odpnet-ora.html) 
- [Oracle.ManagedDataAccess: ORA-01882: timezone region not found' - Oracle Forums](https://forums.oracle.com/ords/apexds/post/oracle-manageddataaccess-ora-01882-timezone-region-not-foun-9972) 
- [UseHourOffsetForUnsupportedTimezone](https://docs.oracle.com/en/database/oracle/oracle-database/21/odpnt/ConnectionUseHourOffsetForUnsupportedTimezone.html#GUID-C66B87C3-0DBB-4609-A57A-D7F9FAD79F72)
- [Oracle.ManagedDataAccess Connection request timed out â€“ iTecNote](https://itecnote.com/tecnote/oracle-manageddataaccess-connection-request-timed-out/)

## å‚è€ƒ

[ã€Dockerã€‘Oracleã‚’ç„¡æ–™ã§ç°¡å˜ã«ãƒ­ãƒ¼ã‚«ãƒ«ã«æ§‹ç¯‰ã™ã‚‹](https://zenn.dev/re24_1986/articles/29430f2f8b4b46)
