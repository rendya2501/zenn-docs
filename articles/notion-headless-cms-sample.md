---
title: "Notionã‚’ä½¿ã£ãŸãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã®æ§‹ç¯‰æ–¹æ³•"
emoji: "ğŸ“‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["csharp","Notion","GitHubActions"]
published: false
---

## æ¦‚è¦

ã“ã®è¨˜äº‹ã§ã¯ã€Notionã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã—ã¦æ´»ç”¨ã—ã€GitHub Actionsã‚’ç”¨ã„ã¦Notionã®ãƒ‡ãƒ¼ã‚¿ã‚’MarkdownåŒ–ã—ã€è‡ªå‹•ã§GitHubã«åæ˜ ã•ã›ã‚‹ä»•çµ„ã¿ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚  

## èƒŒæ™¯

å­¦ç¿’è¨˜éŒ²ã‚’GitHubã§ç®¡ç†ã™ã‚‹ãŸã‚ã«ã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã¦ã„ã¾ã—ãŸãŒã€è¤‡æ•°æŠ€è¡“ãŒçµ¡ã‚€å ´åˆã®ç®¡ç†ãŒç…©é›‘ã§ã—ãŸã€‚  
ä¾‹ãˆã°ã€ã€ŒC#ã§EFCoreã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’ã™ã‚‹ã€ã¨ã„ã†è¨˜äº‹ã‚’æ›¸ã„ãŸå ´åˆã€C#ï¼Ÿ ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼Ÿ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼Ÿ ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæœ€é©ãªã®ã‹æ±ºã‚ã‹ã­ã‚‹ã€ã¨ã„ã£ãŸå…·åˆã§ã™ã€‚  
ãã“ã§ã€**Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ´»ç”¨ã—ã€ã‚¿ã‚°ã§æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•**ã‚’è€ƒãˆã¾ã—ãŸã€‚  

ã—ã‹ã—ã€**å­¦ç¿’è¨˜éŒ²ã¯Notionã«è“„ç©ã•ã‚Œã‚‹ã‚‚ã®ã®ã€GitHubã«ã¯åæ˜ ã•ã‚Œãªã„**ãŸã‚ã€ã›ã£ã‹ãã®å­¦ç¿’æˆæœãŒå½¢ã¨ã—ã¦æ®‹ã‚‰ãªã„ã®ãŒã‚‚ã£ãŸã„ãªã„ã¨æ„Ÿã˜å§‹ã‚ã¾ã—ãŸã€‚  
ã€ŒNotionã«è¨˜éŒ²ã™ã‚‹ã ã‘ã§è‡ªå‹•çš„ã«GitHubã«åŒæœŸã•ã‚Œã‚‹ä»•çµ„ã¿ã€ãŒã‚ã‚Œã°ç†æƒ³çš„ã ã¨è€ƒãˆã¾ã—ãŸã€‚  

## ç†æƒ³ã®é‹ç”¨ãƒ•ãƒ­ãƒ¼

1. Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«å­¦ç¿’è¨˜éŒ²ã‚’è¿½åŠ   
2. è¨˜éŒ²ãŒè‡ªå‹•ã§MarkdownåŒ–ã•ã‚Œã€GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹  

ã“ã®ã‚ˆã†ãªä»•çµ„ã¿ã‚’å®Ÿç¾ã™ã‚‹æ–¹æ³•ã‚’èª¿ã¹ãŸã¨ã“ã‚ã€GitHub Actionsã‚’æ´»ç”¨ã™ã‚Œã°å¯èƒ½ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã—ãŸã€‚  
ãŸã ã—ã€ã‚¼ãƒ­ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è©³ç´°ã«è§£èª¬ã—ãŸè¨˜äº‹ãŒå°‘ãªãã€è©¦è¡ŒéŒ¯èª¤ã‚’ç¹°ã‚Šè¿”ã—ãªãŒã‚‰ã‚ˆã†ã‚„ãå®Ÿè£…ã§ãã¾ã—ãŸã€‚  

## **ãªãœã“ã®è¨˜äº‹ã‚’æ›¸ã„ãŸã®ã‹ï¼Ÿ**

GitHub Actions ã® yml è¨­å®šã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç´¹ä»‹ã™ã‚‹è¨˜äº‹ã¯å¤šãã‚ã‚Šã¾ã™ãŒã€ã‚¼ãƒ­ã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ãŸã‚‚ã®ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚  
ãã®ãŸã‚ã€æœ¬è¨˜äº‹ã§ã¯ GitHub Actions ã®çŸ¥è­˜ãŒã»ã¼ãªã„çŠ¶æ…‹ã‹ã‚‰æ§‹ç¯‰ã—ãŸçµŒé¨“ã‚’ã‚‚ã¨ã«ã€ã‚¼ãƒ­ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®æ§‹ç¯‰æ–¹æ³•ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚  

## ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMS

ã“ã®ã‚ˆã†ãªã‚·ã‚¹ãƒ†ãƒ ã‚’ `ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMS` ã¨è¨€ã†ã‚‰ã—ã„ã§ã™ã€‚  
å…ˆäººãŸã¡ãŒãã®ã‚ˆã†ã«ç´¹ä»‹ã—ã¦ã„ãŸã®ã§ã€è‡ªåˆ†ã‚‚åŒã˜ã‚ˆã†ã«ä½¿ã‚ã›ã¦è²°ã„ã¾ã™ã€‚  

å‚è€ƒè¨˜äº‹:  

- [Notionãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSåŒ–è¨˜éŒ² (3) GitHub Actionsã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ | lacolaco's marginalia](https://blog.lacolaco.net/posts/notion-headless-cms-3/)  

### ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã¯ï¼Ÿ

AIã®å›ç­”ã‚’ãã®ã¾ã¾å¼•ç”¨ã—ã¦ãŠãã¾ã™ã€‚  

>ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSï¼ˆHeadless CMSï¼‰ã¨ã¯ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç®¡ç†ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ã¨è¡¨ç¤ºï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã‚’åˆ†é›¢ã—ãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®ã“ã¨ã§ã™ã€‚é€šå¸¸ã®CMSï¼ˆä¾‹ãˆã° WordPress ãªã©ï¼‰ã¯ã€ç®¡ç†ç”»é¢ã§ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä½œæˆãƒ»ç·¨é›†ã—ã€åŒã˜ã‚·ã‚¹ãƒ†ãƒ å†…ã§ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¨ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚ä¸€æ–¹ã€ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã®ã¿ã‚’æ‹…å½“ã—ã€APIã‚’é€šã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¤–éƒ¨ã®Webã‚µã‚¤ãƒˆã‚„ã‚¢ãƒ—ãƒªã«æä¾›ã—ã¾ã™ã€‚
>
>ã€Œæœ¬ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€Notion ã‚’ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦åˆ©ç”¨ã—ã€GitHub Actions ã‚’é€šã˜ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›ãƒ»åæ˜ ã™ã‚‹ãŸã‚ã€ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMS ã®æ¦‚å¿µã«å½“ã¦ã¯ã¾ã‚Šã¾ã™ã€‚ã€  

ã ãã†ã§ã™ã€‚  

## å‰æãƒ»ç’°å¢ƒ

- OS: Windows 11 HOME 24H2  
- è¨€èª: C#
- ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯: .NET 8
- ãƒ„ãƒ¼ãƒ«: VSCode, GitHub Actions

å®Ÿè£…è¨€èªã¯C#ã§ã™ã€‚ç†ç”±ã¯2ã¤ã‚ã‚Šã¾ã™ã€‚  

1. è‡ªåˆ†ãŒä¸€ç•ªå¾—æ„ãªè¨€èªã ã‹ã‚‰  
2. ã“ã®å®Ÿè£…ã®æ ¸ã¨ãªã‚‹å¤‰æ›ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å¤§æœ¬ãŒC#ã§å®Ÿè£…ã•ã‚Œã¦ã„ãŸã‹ã‚‰  
https://github.com/yucchiy/notion-to-markdown  

æ­£ç›´ã€ã“ã®ãƒªãƒã‚¸ãƒˆãƒªãŒç„¡ã‹ã£ãŸã‚‰å®Ÿè£…å‡ºæ¥ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚  
æœ¬ã‚µãƒ³ãƒ—ãƒ«ã¯ã€ã“ã¡ã‚‰ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ `.Net8`ã«å¯¾å¿œã•ã›ãŸã®ã¨ç´°ã‹ã„éƒ¨åˆ†ã‚’è‡ªåˆ†ãªã‚Šã«ã‚¢ãƒ¬ãƒ³ã‚¸ã—ãŸç‰©ã¨ãªã‚Šã¾ã™ã€‚  

## å®Ÿè£…ãƒ»è§£èª¬

ä»¥ä¸‹ã®æ‰‹é †ã§å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚  

1. Notionã®è¨­å®š  
   1. Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ&ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®š  
   2. NotionAPIåˆ©ç”¨ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—
   3. Notion Database ID ã®å–å¾—
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®š
   1. ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
   2. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ç™»éŒ²
   3. ãƒªãƒã‚¸ãƒˆãƒªã®permissionsã®è¨­å®š
3. C#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ  
4. GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ  

### 1. Notionã®è¨­å®š

#### 1-1. Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ & ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®š

ã¾ãšã¯Notionã§è¨˜äº‹ç®¡ç†ç”¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚  

ãƒ•ãƒ«ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚  
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã¯ä½•ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚  
â€»è‡ªåˆ†ã¯ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ `notion-headless-cms-sample-database` ã¨ã—ã¾ã—ãŸã€‚  

æ¬¡ã«ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚  
ä»¥ä¸‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚  
GitHubé€£æºã®éš›ã«å¿…ãšå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚  

| ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ | ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç¨®é¡ | ç”¨é€” |
|---|---|---|
| **Title** | ã‚¿ã‚¤ãƒˆãƒ« | è¨˜äº‹æœ¬ä½“ã®ã‚¿ã‚¤ãƒˆãƒ«åã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã«å«ã‚ã¾ã™ã€‚ |
| **Slug** | ãƒ†ã‚­ã‚¹ãƒˆ | GitHubã§è¨˜äº‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã«ãªã‚Šã¾ã™ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ã‚¿ã‚¤ãƒˆãƒ«ãŒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã¨ãªã‚Šã¾ã™ã€‚ |
| **PublishedAt** | ä½œæˆæ—¥æ™‚ | è¨˜äº‹ã‚’ä½œæˆã—ãŸæ—¥æ™‚ã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã«å«ã‚ã¾ã™ã€‚ |
| **Type** | ã‚»ãƒ¬ã‚¯ãƒˆ | Zennã®ã‚ˆã†ã«è¨˜äº‹ãŒ`Idea`ã‹`Tech`ãªã®ã‹ã‚’ç¤ºã—ã¾ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã«å«ã‚ã¾ã™ã€‚ |
| **Tags** | ãƒãƒ«ãƒã‚»ãƒ¬ã‚¯ãƒˆ | æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ç­‰ã‚’é¸æŠã™ã‚‹ã‚‚ã®ã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±ã«å«ã‚ã¾ã™ã€‚ |
| **RequestPublishing** | ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ | è¨˜äº‹å…¬é–‹ãƒ•ãƒ©ã‚°ã§ã™ã€‚ã“ã‚Œã«ãƒã‚§ãƒƒã‚¯ãŒã¤ã„ã¦ã„ã‚‹è¨˜äº‹ãŒå…¬é–‹ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™ã€‚ |
| **_SystemCrawledAt** | æœ€çµ‚æ›´æ–°æ—¥æ™‚ | ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰**RequestPublishing**ãƒ•ãƒ©ã‚°ã‚’æ“ä½œã™ã‚‹ãŸã‚ã€ãã®æ›´æ–°æ—¥æ™‚ã‚’åæ˜ æŒ‡ã›ã‚‹ç‚ºã«å¿…è¦ã¨ãªã‚Šã¾ã™ã€‚ |

![alt text](../images/notion-headless-cms-sample/notion-database.png)
<!-- ![alt text](../images/notion-headless-cms-sample/notion-article1.png) -->

#### 1-2. NotionAPIåˆ©ç”¨ã®ãŸã‚ã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—

ã“ã¡ã‚‰ã®è¨˜äº‹([Notion APIã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³](https://programming-zero.net/notion-api-setting/))ã‚’å‚è€ƒã«`ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³`ãªã‚‹ã‚‚ã®ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚  
`GitHub Actions` ã® `Seacrets` ã§ä½¿ã†ã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚  

#### 1-3. Notion Database ID ã®å–å¾—

åŒã˜ãã“ã¡ã‚‰ã®è¨˜äº‹([ã€Notionã€‘ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã‚’ç¢ºèªã—ã‚ˆã†ï½œã‚ã¾ã¦ãƒ](https://note.com/amatyrain/n/nb9ebe31dfab7))ã‚’å‚è€ƒã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚  

ç°¡å˜ãªã®ã§ãã®ã¾ã¾å¼•ç”¨ã•ã›ã¦é ‚ãã¾ã™ã€‚  
>â‘¢URLã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã‚’ç¢ºèª
>
>URLã¯ã€Œ`https://www.notion.so/XXXXXXXX?v=YYYYYYYY`ã€ã¨ã„ã£ãŸå½¢å¼ã¨ãªã£ã¦ã„ã¾ã™ãŒã€ãã®ã€Œ`XXXXXXXX`ã€ã®éƒ¨åˆ†ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã¨ãªã‚Šã¾ã™  

ã“ã¡ã‚‰ã‚‚ `GitHub Actions` ã® `Seacrets` ã§ä½¿ã†ã®ã§ãƒ¡ãƒ¢ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚  

### 2. GitHubãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®š  

#### 2-1. ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

æ–°è¦ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ãƒªãƒã‚¸ãƒˆãƒªåã¯ä½•ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚  
â€»è‡ªåˆ†ã¯ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ `notion-headless-cms-sample` ã¨ã—ã¾ã—ãŸã€‚  

ã“ã“ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã«ã¤ã„ã¦ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚  
ä»Šå¾Œã®ä½œæ¥­ã«ãŠã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã§ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚  

å¾Œã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `articles` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¦ `.keep` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚  
`articles` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½è·¡å¯¾è±¡ã¨ã™ã‚‹ç‚ºã«ãƒ€ãƒŸãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  
â€»`articles` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„ã¨ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“â€¦

``` txt
notion-headless-cms-sample/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ workflow.yml        # GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .gitignore              # ignore file
â”‚   â”œâ”€â”€ Program.cs              # ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”‚   â””â”€â”€ NotionToMarkdown.csproj # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ articles/                   # è¨˜äº‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    â”œâ”€â”€ yyyy/
    |   â”œâ”€â”€ mm/
    |   â”‚   â”œâ”€â”€ Hoge.md
    |   â”‚   â””â”€â”€ Fuga.md
    |   â””â”€â”€ mm/
    |       â””â”€â”€ Piyo.md
    â””â”€â”€ .keep # articlesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½è·¡å¯¾è±¡ã¨ã™ã‚‹ãŸã‚ã®ãƒ€ãƒŸãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
```

#### 2-2. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã«ç™»éŒ²

ã“ã¡ã‚‰ã®è¨˜äº‹([GitHub Actions ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæƒ…å ±ã¨å¤‰æ•°ã®è¨­å®šæ–¹æ³• #GitHubActions - Qiita](https://qiita.com/mkin/items/75a4928a1fafe5eacd17))ã‚’å‚è€ƒã«ã—ãªãŒã‚‰è¨­å®šã™ã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã¨æ€ã„ã¾ã™ã€‚  

- `ãƒªãƒã‚¸ãƒˆãƒªã®Settingsã‚¿ãƒ–`
- `Secrets and variablesã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å†…ã®Actions`  
- `New repository secret` ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹  

Notionã®è¨­å®šæ™‚ã«ãƒ¡ãƒ¢ã—ã¦ãŠã„ãŸ`ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³`ã¨`Notion Database ID`ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚  
`ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹`ã¨`ãƒ¦ãƒ¼ã‚¶ãƒ¼å`ã«é–¢ã—ã¦ã¯GitHub Actionsã‚’å®Ÿè¡Œã—ãŸæ™‚ã«è‰ã‚’ç”Ÿã‚„ã™ãŸã‚ã«å¿…è¦ã§ã™ã€‚  

| å¤‰æ•°å | æ ¼ç´ã™ã‚‹å€¤ |
|---|---|
| **NOTION_AUTH_TOKEN** | `1-2.` ã§å–å¾—ã—ãŸ **Notion APIã®ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³** |
| **NOTION_DATABASE_ID** | `1-3.` ã§å–å¾—ã—ãŸ **Notion Database ID** |
| **USER_EMAIL** | githubã«ç™»éŒ²ã—ã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ |
| **USER_NAME** | githubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å |

#### 2-3. ãƒªãƒã‚¸ãƒˆãƒªã®permissionsã®è¨­å®š

æ¬¡ã«ãƒªãƒã‚¸ãƒˆãƒªã®`Workflow permissions`ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚  

- `ãƒªãƒã‚¸ãƒˆãƒªã®Settingsã‚¿ãƒ–`  
- `Actionsã®ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å†…ã®General`  
- `Workflow permissions` ã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’ç¢ºèª  
- `Read and Write permissions` ã«å¤‰æ›´

åˆæœŸçŠ¶æ…‹ã¯ `Read repository contents and packages permissions` ã¨ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚Œã‚’ `Read and Write permissions` ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚  
ã“ã“ã‚’å¤‰æ›´ã—ã¦ãŠã‹ãªã„ã¨ã€GitHub Actionsã‚’å®Ÿè¡Œã—ãŸæ™‚ã«`403`ã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚  

![alt text](../images/notion-headless-cms-sample/github-actions-permission-error.png)

- **Read and Write permissions(èª­ã¿å–ã‚Šã¨æ›¸ãè¾¼ã¿ã®æ¨©é™)**  
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã¯ã€ã™ã¹ã¦ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«å¯¾ã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã¸ã®èª­ã¿å–ã‚Šã¨æ›¸ãè¾¼ã¿ã®æ¨©é™ãŒã‚ã‚Šã¾ã™ã€‚  
- **Read repository contents and packages permissions(ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®èª­ã¿å–ã‚Šæ¨©é™)**  
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¹ã‚³ãƒ¼ãƒ—ã«å¯¾ã—ã¦ã®ã¿èª­ã¿å–ã‚Šæ¨©é™ã‚’æŒã¡ã¾ã™ã€‚  

### 3. C#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ  

GitHub Actionsã§å®Ÿè¡Œã™ã‚‹å‡¦ç†ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚  
ãƒ­ãƒ¼ã‚«ãƒ«ã«`git clone`ã—ã¦VSCodeã§ä½œæ¥­ã™ã‚‹ã‹ã€GitHubã®`Codespaces`ã®ã©ã¡ã‚‰ã‹ã§ä½œæ¥­ã™ã‚‹äº‹ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚  
dotnetã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹æ–¹æ³•ãŒæ™®é€šã§ã™ãŒã€æ‰‹å‹•ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ä¸­èº«ã‚’å®Œå…¨ã«ã‚³ãƒ”ãƒšã™ã‚‹æ–¹æ³•ã§ã‚‚å®Ÿç¾å¯èƒ½ã§ã™ã€‚  

å¿…è¦ãªã®ã¯ä»¥ä¸‹ã®3ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚  

- `NotionToMarkdown.csproj (ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«)`
- `Program.cs (ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ•ã‚¡ã‚¤ãƒ«)`
- `.gitignore (ignoreãƒ•ã‚¡ã‚¤ãƒ«)`

``` txt
notion-headless-cms-sample/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ Program.cs
â”‚   â””â”€â”€ NotionToMarkdown.csproj
```

å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚  
https://github.com/rendya2501/notion-headless-cms-sample/tree/main/src  

ä¸€å¿œã€`dotnet` ã‚³ãƒãƒ³ãƒ‰ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹æ‰‹é †ã‚‚è¼‰ã›ã¦ãŠãã¾ã™ã€‚  

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ  

``` bash
dotnet new console -f net8.0 -o src -n NotionToMarkdown
```

- ä¾å­˜é–¢ä¿‚ã®è¿½åŠ   

``` bash
cd src
dotnet add package Notion.Net --version 4.2.0
dotnet add package Scriban --version 5.12.1
```

- ignoreãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ  

``` bash
dotnet new gitignore
```

- Program.csã®ã‚³ãƒ”ãƒš

:::details Program.cs

``` cs
using Notion.Client;
using System.Security.Cryptography;
using System.Text;

var notionTitlePropertyName = "Title";
var notionTypePropertyName = "Type";
var notionPublishedAtPropertyName = "PublishedAt";
var notionRequestPublisingPropertyName = "RequestPublishing";
var notionCrawledAtPropertyName = "_SystemCrawledAt";
var notionTagsPropertyName = "Tags";
var notionDescriptionPropertyName = "Description";
var notionSlugPropertyName = "Slug";

var frontMatterTitleName = "title";
var frontMatterTypeName = "type";
var frontMatterPublishedName = "date";
var frontMatterDescriptionName = "description";
var frontMatterTagsName = "tags";
var frontMatterEyecatch = "eyecatch";

if (args.Length != 3)
{
    throw new ArgumentException("args length should be three.");
}

// å¼•æ•°ã‹ã‚‰Notionã®èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã€å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—
var notionAuthToken = args[0];
var notionDatabaseId = args[1];
var outputDirectoryPathTemplate = args[2];

// Notionãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’è¨­å®š
var filter = new CheckboxFilter(notionRequestPublisingPropertyName, true);
// æ›´æ–°ãƒ•ãƒ©ã‚°ãŒç«‹ã£ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ã‚’å–å¾—
var pagination = await CreateNotionClient().Databases.QueryAsync(notionDatabaseId, new DatabasesQueryParameters()
{
    Filter = filter,
});

var now = DateTime.Now;
// ãƒšãƒ¼ã‚¸ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ•°
var exportedCount = 0;

// ãƒšãƒ¼ã‚¸ã‚’å–å¾—ã—ã¦Markdownå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
do
{
    // ãƒšãƒ¼ã‚¸ã”ã¨ã«å‡¦ç†
    foreach (var page in pagination.Results)
    {
        // ãƒšãƒ¼ã‚¸ã‚’Markdownå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        if (!await ExportPageToMarkdownAsync(page, now))
        {
            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ãŸå ´åˆã¯æ¬¡ã®ãƒšãƒ¼ã‚¸ã«é€²ã‚€
            continue;
        }

        // ãƒšãƒ¼ã‚¸ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’æ›´æ–°
        await CreateNotionClient().Pages.UpdateAsync(page.Id, new PagesUpdateParameters()
        {
            Properties = new Dictionary<string, PropertyValue>()
            {
                // æœ€çµ‚æ›´æ–°æ—¥æ™‚ã‚’æ›´æ–°
                [notionCrawledAtPropertyName] = new DatePropertyValue()
                {
                    Date = new Date()
                    {
                        Start = now,
                    }
                },
                // æ›´æ–°ãƒ•ãƒ©ã‚°ã‚’ä¸‹ã’ã‚‹
                [notionRequestPublisingPropertyName] = new CheckboxPropertyValue()
                {
                    Checkbox = false,
                },
            }
        });

        exportedCount++;
    }

    // æ¬¡ã®ãƒšãƒ¼ã‚¸ãŒãªã„å ´åˆã¯çµ‚äº†
    if (!pagination.HasMore)
    {
        break;
    }

    // æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—
    pagination = await CreateNotionClient().Databases.QueryAsync(notionDatabaseId, new DatabasesQueryParameters
    {
        Filter = filter,
        StartCursor = pagination.NextCursor,
    });
} while (true);

// GITHUB_ENVç’°å¢ƒå¤‰æ•°ã®ãƒ‘ã‚¹ã‚’å–å¾—
var githubEnvPath = Environment.GetEnvironmentVariable("GITHUB_ENV") ?? string.Empty;
// GITHUB_ENVç’°å¢ƒå¤‰æ•°ãŒå–å¾—ã§ããªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’å‡ºåŠ›
if (string.IsNullOrEmpty(githubEnvPath))
{
    throw new InvalidOperationException("The GITHUB_ENV environment variable is not set.");
}

var writeLineExportedCount = $"EXPORTED_COUNT={exportedCount}";
// GITHUB_ENVã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®æ•°ã‚’æ›¸ãè¾¼ã‚€
using (var writer = new StreamWriter(githubEnvPath, true))
{
    writer.WriteLine(writeLineExportedCount);
}
Console.WriteLine(writeLineExportedCount);



/// <summary>
/// Notionã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
/// </summary>
/// <returns>Notionã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</returns>
NotionClient CreateNotionClient()
{
    return NotionClientFactory.Create(new ClientOptions
    {
        AuthToken = notionAuthToken,
    });
}

/// <summary>
/// æŒ‡å®šã•ã‚ŒãŸNotionãƒšãƒ¼ã‚¸ã‚’Markdownå½¢å¼ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚
/// </summary>
/// <param name="page">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹Notionãƒšãƒ¼ã‚¸</param>
/// <param name="now">ç¾åœ¨ã®æ—¥æ™‚</param>
/// <param name="forceExport">å¼·åˆ¶çš„ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã‹ã©ã†ã‹</param>
/// <returns>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹ã‚’ç¤ºã™ã‚¿ã‚¹ã‚¯</returns>
async Task<bool> ExportPageToMarkdownAsync(Page page, DateTime now, bool forceExport = false)
{
    bool requestPublishing = false;
    string title = string.Empty;
    string type = string.Empty;
    string slug = page.Id;
    string description = string.Empty;
    List<string>? tags = null;
    DateTime? publishedDateTime = null;
    DateTime? lastSystemCrawledDateTime = null;

    // frontmatterã‚’æ§‹ç¯‰
    foreach (var property in page.Properties)
    {
        if (property.Key == notionPublishedAtPropertyName)
        {
            if (TryParsePropertyValueAsDateTime(property.Value, out var parsedPublishedAt))
            {
                publishedDateTime = parsedPublishedAt;
            }
        }
        else if (property.Key == notionCrawledAtPropertyName)
        {
            if (TryParsePropertyValueAsDateTime(property.Value, out var parsedCrawledAt))
            {
                lastSystemCrawledDateTime = parsedCrawledAt;
            }
        }
        else if (property.Key == notionSlugPropertyName)
        {
            if (TryParsePropertyValueAsPlainText(property.Value, out var parsedSlug))
            {
                slug = parsedSlug;
            }
        }
        else if (property.Key == notionTitlePropertyName)
        {
            if (TryParsePropertyValueAsPlainText(property.Value, out var parsedTitle))
            {
                title = parsedTitle;
            }
        }
        else if (property.Key == notionDescriptionPropertyName)
        {
            if (TryParsePropertyValueAsPlainText(property.Value, out var parsedDescription))
            {
                description = parsedDescription;
            }
        }
        else if (property.Key == notionTagsPropertyName)
        {
            if (TryParsePropertyValueAsStringSet(property.Value, out var parsedTags))
            {
                tags = parsedTags.Select(tag => $"\"{tag}\"").ToList();
            }
        }
        else if (property.Key == notionTypePropertyName)
        {
            if (TryParsePropertyValueAsPlainText(property.Value, out var parsedType))
            {
                type = parsedType;
            }
        }
        else if (property.Key == notionRequestPublisingPropertyName)
        {
            if (TryParsePropertyValueAsBoolean(property.Value, out var parsedBoolean))
            {
                requestPublishing = parsedBoolean;
            }
        }
    }

    if (!requestPublishing)
    {
        Console.WriteLine($"{page.Id}(title = {title}): No request publishing.");
        return false;
    }

    if (!publishedDateTime.HasValue)
    {
        Console.WriteLine($"{page.Id}(title = {title}): Skip updating becase this page don't have publish ate.");
        return false;
    }

    if (!forceExport)
    {
        if (now < publishedDateTime.Value)
        {
            Console.WriteLine($"{page.Id}(title = {title}): Skip updating because the publication date have not been reached");
            return false;
        }
    }

    slug = string.IsNullOrEmpty(slug) ? title : slug;
    var outputDirectory = BuildOutputDirectory(publishedDateTime.Value, title, slug);
    if (!Directory.Exists(outputDirectory))
    {
        Directory.CreateDirectory(outputDirectory);
    }

    var stringBuilder = new StringBuilder();
    stringBuilder.AppendLine("---");

    if (!string.IsNullOrWhiteSpace(type))
    {
        stringBuilder.AppendLine($"{frontMatterTypeName}: \"{type}\"");
    }

    stringBuilder.AppendLine($"{frontMatterTitleName}: \"{title}\"");

    if (!string.IsNullOrWhiteSpace(description))
    {
        stringBuilder.AppendLine($"{frontMatterDescriptionName}: \"{description}\"");
    }
    if (tags is not null)
    {
        stringBuilder.AppendLine($"{frontMatterTagsName}: [{string.Join(',', tags)}]");
    }
    stringBuilder.AppendLine($"{frontMatterPublishedName}: \"{publishedDateTime.Value.ToString("s")}\"");

    if (page.Cover is not null && page.Cover is UploadedFile uploadedFile)
    {
        var (fileName, _) = await DownloadImage(uploadedFile.File.Url, outputDirectory);
        stringBuilder.AppendLine($"{frontMatterEyecatch}: \"./{fileName}\"");
    }

    stringBuilder.AppendLine("");
    stringBuilder.AppendLine("---");
    stringBuilder.AppendLine("");


    // ãƒšãƒ¼ã‚¸ã®å†…å®¹ã‚’è¿½åŠ 
    var pagination = await CreateNotionClient().Blocks.RetrieveChildrenAsync(page.Id);
    do
    {
        foreach (Block block in pagination.Results.Cast<Block>())
        {
            await AppendBlockLineAsync(block, string.Empty, outputDirectory, stringBuilder);
        }

        if (!pagination.HasMore)
        {
            break;
        }

        pagination = await CreateNotionClient().Blocks.RetrieveChildrenAsync(page.Id, new BlocksRetrieveChildrenParameters
        {
            StartCursor = pagination.NextCursor,
        });
    } while (true);

    using var fileStream = File.OpenWrite($"{outputDirectory}/index.md");
    using var streamWriter = new StreamWriter(fileStream, new UTF8Encoding(false));
    await streamWriter.WriteAsync(stringBuilder.ToString());

    return true;
}

/// <summary>
/// å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚
/// </summary>
/// <param name="publishedDate">å…¬é–‹æ—¥</param>
/// <param name="title">ã‚¿ã‚¤ãƒˆãƒ«</param>
/// <param name="slug">ã‚¹ãƒ©ãƒƒã‚°</param>
/// <returns>å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ãƒ‘ã‚¹</returns>
string BuildOutputDirectory(DateTime publishedDate, string title, string slug)
{
    var template = Scriban.Template.Parse(outputDirectoryPathTemplate);
    return template.Render(new
    {
        publish = publishedDate,
        title = title,
        slug = slug,
    });
}

/// <summary>
/// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’DateTimeã¨ã—ã¦è§£æã—ã¾ã™ã€‚
/// </summary>
/// <param name="value">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤</param>
/// <param name="dateTime">è§£æã•ã‚ŒãŸDateTime</param>
/// <returns>è§£æãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹</returns>
bool TryParsePropertyValueAsDateTime(PropertyValue value, out DateTime dateTime)
{
    dateTime = default;
    switch (value)
    {
        case DatePropertyValue dateProperty:
            if (dateProperty.Date == null) return false;
            if (!dateProperty.Date.Start.HasValue) return false;

            dateTime = dateProperty.Date.Start.Value;

            break;
        case CreatedTimePropertyValue createdTimeProperty:
            if (!DateTime.TryParse(createdTimeProperty.CreatedTime, out dateTime))
            {
                return false;
            }

            break;
        case LastEditedTimePropertyValue lastEditedTimeProperty:
            if (!DateTime.TryParse(lastEditedTimeProperty.LastEditedTime, out dateTime))
            {
                return false;
            }

            break;

        default:
            if (!TryParsePropertyValueAsPlainText(value, out var plainText))
            {
                return false;
            }

            if (!DateTime.TryParse(plainText, out dateTime))
            {
                return false;
            }

            break;
    }

    return true;
}


/// <summary>
/// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è§£æã—ã¾ã™ã€‚
/// </summary>
/// <param name="value">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤</param>
/// <param name="text">è§£æã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ</param>
/// <returns>è§£æãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹</returns>
bool TryParsePropertyValueAsPlainText(PropertyValue value, out string text)
{
    text = string.Empty;
    switch (value)
    {
        case RichTextPropertyValue richTextProperty:
            foreach (var richText in richTextProperty.RichText)
            {
                text += richText.PlainText;
            }
            break;
        case TitlePropertyValue titleProperty:
            foreach (var richText in titleProperty.Title)
            {
                text += richText.PlainText;
            }
            break;
        case SelectPropertyValue selectPropertyValue:
            text = selectPropertyValue.Select?.Name ?? "";
            break;
        default:
            return false;
    }

    return true;
}


/// <summary>
/// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’æ–‡å­—åˆ—ã‚»ãƒƒãƒˆã¨ã—ã¦è§£æã—ã¾ã™ã€‚
/// </summary>
/// <param name="value">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤</param>
/// <param name="set">è§£æã•ã‚ŒãŸæ–‡å­—åˆ—ã‚»ãƒƒãƒˆ</param>
/// <returns>è§£æãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹</returns>
bool TryParsePropertyValueAsStringSet(PropertyValue value, out List<string> set)
{
    //set = new List<string>();
    set = [];
    switch (value)
    {
        case MultiSelectPropertyValue multiSelectProperty:
            foreach (var selectValue in multiSelectProperty.MultiSelect)
            {
                set.Add(selectValue.Name);
            }
            break;
        default:
            return false;
    }

    return true;
}


/// <summary>
/// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤ã‚’ãƒ–ãƒ¼ãƒ«å€¤ã¨ã—ã¦è§£æã—ã¾ã™ã€‚
/// </summary>
/// <param name="value">ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£å€¤</param>
/// <param name="boolean">è§£æã•ã‚ŒãŸãƒ–ãƒ¼ãƒ«å€¤</param>
/// <returns>è§£æãŒæˆåŠŸã—ãŸã‹ã©ã†ã‹</returns>
bool TryParsePropertyValueAsBoolean(PropertyValue value, out bool boolean)
{
    boolean = false;
    switch (value)
    {
        case CheckboxPropertyValue checkboxProperty:
            boolean = checkboxProperty.Checkbox;
            break;
        default:
            return false;
    }

    return true;
}


/// <summary>
/// ãƒ–ãƒ­ãƒƒã‚¯è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="block">ãƒ–ãƒ­ãƒƒã‚¯</param>
/// <param name="indent">ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</param>
/// <param name="outputDirectory">å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</param>
/// <param name="stringBuilder">StringBuilder</param>
/// <returns>ã‚¿ã‚¹ã‚¯</returns>
async Task AppendBlockLineAsync(Block block, string indent, string outputDirectory, StringBuilder stringBuilder)
{
    switch (block)
    {
        case ParagraphBlock paragraphBlock:
            foreach (var text in paragraphBlock.Paragraph.RichText)
            {
                AppendRichText(text, stringBuilder);
            }
            stringBuilder.AppendLine(string.Empty);
            break;
        case HeadingOneBlock h1:
            stringBuilder.Append($"{indent}# ");
            foreach (var text in h1.Heading_1.RichText)
            {
                AppendRichText(text, stringBuilder);
            }
            stringBuilder.AppendLine(string.Empty);
            break;
        case HeadingTwoBlock h2:
            stringBuilder.Append($"{indent}## ");
            foreach (var text in h2.Heading_2.RichText)
            {
                AppendRichText(text, stringBuilder);
            }
            stringBuilder.AppendLine(string.Empty);
            break;
        case HeadingThreeBlock h3:
            stringBuilder.Append($"{indent}### ");
            foreach (var text in h3.Heading_3.RichText)
            {
                AppendRichText(text, stringBuilder);
            }
            stringBuilder.AppendLine(string.Empty);
            break;
        case ImageBlock imageBlock:
            await AppendImageAsync(imageBlock, indent, outputDirectory, stringBuilder);
            stringBuilder.AppendLine(string.Empty);
            break;
        case CodeBlock codeBlock:
            AppendCode(codeBlock, indent, stringBuilder);
            stringBuilder.AppendLine(string.Empty);
            break;
        case BulletedListItemBlock bulletListItemBlock:
            AppendBulletListItem(bulletListItemBlock, indent, stringBuilder);
            break;
        case NumberedListItemBlock numberedListItemBlock:
            AppendNumberedListItem(numberedListItemBlock, indent, stringBuilder);
            break;
        case BookmarkBlock bookmarkBlock:
            var caption = bookmarkBlock.Bookmark.Caption.FirstOrDefault()?.PlainText;
            var url = bookmarkBlock.Bookmark.Url;
            if (!string.IsNullOrEmpty(caption))
            {
                stringBuilder.Append($"[{caption}]({url})");
                break;
            }
            stringBuilder.Append($"<{url}>");
            break;
        case DividerBlock divider:
            stringBuilder.Append("---");
            break;
    }

    stringBuilder.AppendLine(string.Empty);

    if (block.HasChildren)
    {
        var pagination = await CreateNotionClient().Blocks.RetrieveChildrenAsync(block.Id);
        do
        {
            foreach (Block childBlock in pagination.Results.Cast<Block>())
            {
                await AppendBlockLineAsync(childBlock, $"    {indent}", outputDirectory, stringBuilder);
            }

            if (!pagination.HasMore)
            {
                break;
            }

            pagination = await CreateNotionClient().Blocks.RetrieveChildrenAsync(block.Id, new BlocksRetrieveChildrenParameters
            {
                StartCursor = pagination.NextCursor,
            });
        } while (true);
    }
}


/// <summary>
/// ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="richText">ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆ</param>
/// <param name="stringBuilder">StringBuilder</param>
void AppendRichText(RichTextBase richText, StringBuilder stringBuilder)
{
    var text = richText.PlainText;

    if (!string.IsNullOrEmpty(richText.Href))
    {
        text = $"[{text}]({richText.Href})";
    }

    if (richText.Annotations.IsCode)
    {
        text = $"`{text}`";
    }

    if (richText.Annotations.IsItalic && richText.Annotations.IsBold)
    {
        text = $"***{text}***";
    }
    else if (richText.Annotations.IsBold)
    {
        text = $"**{text}**";
    }
    else if (richText.Annotations.IsItalic)
    {
        text = $"*{text}*";
    }

    if (richText.Annotations.IsStrikeThrough)
    {
        text = $"~{text}~";
    }

    stringBuilder.Append(text);
}


/// <summary>
/// ç”»åƒã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="imageBlock">ç”»åƒãƒ–ãƒ­ãƒƒã‚¯</param>
/// <param name="indent">ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</param>
/// <param name="outputDirectory">å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</param>
/// <param name="stringBuilder">StringBuilder</param>
/// <returns>ã‚¿ã‚¹ã‚¯</returns>
async Task AppendImageAsync(ImageBlock imageBlock, string indent, string outputDirectory, StringBuilder stringBuilder)
{
    var url = string.Empty;
    switch (imageBlock.Image)
    {
        case ExternalFile externalFile:
            url = externalFile.External.Url;
            break;
        case UploadedFile uploadedFile:
            url = uploadedFile.File.Url;
            break;
    }

    if (!string.IsNullOrEmpty(url))
    {
        var (fileName, _) = await DownloadImage(url, outputDirectory);
        stringBuilder.Append($"{indent}![](./{fileName})");
    }
}


/// <summary>
/// ç”»åƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
/// </summary>
/// <param name="url">ç”»åƒã®URL</param>
/// <param name="outputDirectory">å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</param>
/// <returns>ãƒ•ã‚¡ã‚¤ãƒ«åã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ã‚¿ãƒ—ãƒ«</returns>
async Task<(string, string)> DownloadImage(string url, string outputDirectory)
{
    var uri = new Uri(url);
    var input = Encoding.UTF8.GetBytes(uri.LocalPath);
    var fileName = $"{Convert.ToHexString(MD5.HashData(input))}{Path.GetExtension(uri.LocalPath)}";
    var filePath = $"{outputDirectory}/{fileName}";

    using var client = new HttpClient();
    var response = await client.GetAsync(uri);
    response.EnsureSuccessStatusCode();
    await using var fs = new FileStream(filePath, FileMode.Create, FileAccess.Write, FileShare.None);
    await response.Content.CopyToAsync(fs);

    return (fileName, filePath);
}


/// <summary>
/// ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="codeBlock">ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯</param>
/// <param name="indent">ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</param>
/// <param name="stringBuilder">StringBuilder</param>
void AppendCode(CodeBlock codeBlock, string indent, StringBuilder stringBuilder)
{
    stringBuilder.AppendLine($"{indent}```{NotionCodeLanguageToMarkdownCodeLanguage(codeBlock.Code.Language)}");
    foreach (var richText in codeBlock.Code.RichText)
    {
        // stringBuilder.Append(indent);
        // AppendRichText(richText, stringBuilder);
        // stringBuilder.AppendLine(string.Empty);
        string text = richText.PlainText.Replace("\t", "    "); // ã‚¿ãƒ–ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã«å¤‰æ›
        stringBuilder.Append(indent);
        stringBuilder.Append(text);
        stringBuilder.AppendLine(string.Empty);
    }
    stringBuilder.AppendLine($"{indent}```");
}


/// <summary>
/// Notionã®ã‚³ãƒ¼ãƒ‰è¨€èªã‚’Markdownã®ã‚³ãƒ¼ãƒ‰è¨€èªã«å¤‰æ›ã—ã¾ã™ã€‚
/// </summary>
/// <param name="language">Notionã®ã‚³ãƒ¼ãƒ‰è¨€èª</param>
/// <returns>Markdownã®ã‚³ãƒ¼ãƒ‰è¨€èª</returns>
string NotionCodeLanguageToMarkdownCodeLanguage(string language)
{
    return language switch
    {
        "c#" => "csharp",
        _ => language,
    };
}


/// <summary>
/// ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆé …ç›®ã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="bulletedListItemBlock">ç®‡æ¡æ›¸ããƒªã‚¹ãƒˆé …ç›®ãƒ–ãƒ­ãƒƒã‚¯</param>
/// <param name="indent">ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</param>
/// <param name="stringBuilder">StringBuilder</param>
void AppendBulletListItem(BulletedListItemBlock bulletedListItemBlock, string indent, StringBuilder stringBuilder)
{
    stringBuilder.Append($"{indent}* ");
    foreach (var item in bulletedListItemBlock.BulletedListItem.RichText)
    {
        AppendRichText(item, stringBuilder);
    }
}


/// <summary>
/// ç•ªå·ä»˜ããƒªã‚¹ãƒˆé …ç›®ã‚’è¿½åŠ ã—ã¾ã™ã€‚
/// </summary>
/// <param name="numberedListItemBlock">ç•ªå·ä»˜ããƒªã‚¹ãƒˆé …ç›®ãƒ–ãƒ­ãƒƒã‚¯</param>
/// <param name="indent">ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ</param>
/// <param name="stringBuilder">StringBuilder</param>
void AppendNumberedListItem(NumberedListItemBlock numberedListItemBlock, string indent, StringBuilder stringBuilder)
{
    stringBuilder.Append($"{indent}1. ");
    foreach (var item in numberedListItemBlock.NumberedListItem.RichText)
    {
        AppendRichText(item, stringBuilder);
    }
}
```

:::

### 4. GitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ  

GitHub Actionsã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«(`yml`)ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚  
`.github/workflows`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãã®ä¸­ã«`workflow.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚  

``` txt
notion-headless-cms-sample/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ workflow.yml
```

ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã¯æ¬¡ã®é€šã‚Šã§ã™ã€‚  
`workflow.yml`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚

:::details workflow.yml

```yml
name: Notion to Markdown Workflow

on:
  workflow_dispatch:
  # 23:30 ã«å®Ÿè¡Œã™ã‚‹(9æ™‚é–“ã®æ™‚å·®ã‚’è€ƒæ…®)
  schedule:
    - cron: '30 14 * * *'

jobs:
  notion_to_markdown:
    runs-on: ubuntu-latest

    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Checkout repository
        uses: actions/checkout@v4

      # .NETã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Set up .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0'

      # ä¾å­˜é–¢ä¿‚ã‚’å¾©å…ƒã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Restore dependencies
        run: dotnet restore src/NotionToMarkdown.csproj

      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Build
        run: dotnet build src/NotionToMarkdown.csproj --configuration Release --no-restore

      # å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ“ãƒ«ãƒ‰ã—ã€å®Ÿè¡Œå¯èƒ½ãªå½¢å¼ã«å¤‰æ›ã—ã¦å‡ºåŠ›ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«é…ç½®ã—ã¾ã™
      - name: Publish
        run: dotnet publish src/NotionToMarkdown.csproj --configuration Release --output ./out --no-build

      # Notionã‹ã‚‰Markdownã«å¤‰æ›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Run Notion to Markdown
        run: |
          dotnet ./out/NotionToMarkdown.dll \
            ${{ secrets.NOTION_AUTH_TOKEN }} \
            ${{ secrets.NOTION_DATABASE_ID }} \
            "articles/{{publish|date.to_string('%Y/%m')}}/{{slug}}"

      # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«æ•°ã‚’ç¢ºèªã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      # ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãŒ0ã®å ´åˆã¯ã€å‡¦ç†çµ‚äº†
      - name: Check for exported files
        if: env.EXPORTED_COUNT == '0'
        run: exit 0

      # ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚ŒãŸMarkdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«åæ˜ ã™ã‚‹ã‚¹ãƒ†ãƒƒãƒ—
      - name: Commit exported markdown files
        run: |
          git config --global user.email "${{ secrets.USER_EMAIL }}"
          git config --global user.name "${{ secrets.USER_NAME }}"
          git add articles/
          git commit -m "Import files from notion database" || exit 0
          git push
```

:::

## ãƒ‡ãƒ¢

ã¾ãšNotionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã—ã¦ã€  

![alt text](../images/notion-headless-cms-sample/notion-database.png)

ã“ã‚“ãªæ„Ÿã˜ã®è¨˜äº‹ã‚’æ›¸ã„ãŸã¨ã—ã¾ã™ã€‚  

![alt text](../images/notion-headless-cms-sample/notion-article1.png)
![alt text](../images/notion-headless-cms-sample/notion-article2.png)

GitHub Actionsã‚’å®Ÿè¡Œã—ã¾ã—ã¦ã€

![alt text](../images/notion-headless-cms-sample/github-actions-demo.png)

ãã‚ŒãŒæˆåŠŸã™ã‚‹ã¨Notionã®è¨˜äº‹ãŒãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã€GitHubã«è‰ãŒç”Ÿãˆã¾ã™ã€‚  

![alt text](../images/notion-headless-cms-sample/github-article-demo.png)

## å‚è€ƒãƒ»ãƒªãƒ³ã‚¯

[Notionã§ãƒ–ãƒ­ã‚°ã‚’æ›¸ã | Yucchiy's Note](https://blog.yucchiy.com/2022/05/blogging-with-notion/)  
[C#ã§Custom GitHub Actionã‚’æ›¸ã | Yucchiy's Note](https://blog.yucchiy.com/2022/05/implement-custom-github-action-with-csharp/)  
https://github.com/yucchiy/notion-to-markdown  

<!-- Notionãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSåŒ–è¨˜éŒ² (3) GitHub Actionsã¨è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ | lacolaco's marginalia -->
https://blog.lacolaco.net/posts/notion-headless-cms-3/  

<!-- çµå±€Githubã«å­¦ç¿’å±¥æ­´ã‚’çµ±ä¸€ã—ãŸæ–¹ãŒè«¸ã€…è‰¯ã‹ã£ãŸ -->
https://zenn.dev/bun913/articles/study-history-on-github   

## ãƒªãƒã‚¸ãƒˆãƒª

ã“ã®è¨˜äº‹ã§ä½œæˆã—ãŸæˆæœç‰©ã‚’ç½®ã„ã¦ã„ã¾ã™ã€‚  
å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚  

https://github.com/rendya2501/notion-headless-cms-sample

<!-- GitHub Actionsã‚„ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç´¹ä»‹ã—ã¦ã„ã‚‹è¨˜äº‹ã¯ã‚ã‚‹ã‚‚ã®ã®ã€ã‚¼ãƒ­ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’è©³ã—ãè§£èª¬ã—ã¦ã„ã‚‹ã‚µã‚¤ãƒˆã¯è¦‹ã¤ã‹ã‚‰ãšâ€¦ã€‚  
å½“æ™‚ã¯æ™‚é–“ã‚‚ãªã‹ã£ãŸãŸã‚ã€åŠã°è«¦ã‚ã‹ã‘ã¦ã„ã¾ã—ãŸã€‚  
ã—ã‹ã—ã€ã©ã†ã—ã¦ã‚‚å®Ÿç¾ã—ãŸã‹ã£ãŸã®ã§ã€GitHub Actionsã‚’ä¸€ã‹ã‚‰å­¦ã³ã€AIã®åŠ›ã‚‚å€Ÿã‚ŠãªãŒã‚‰è©¦è¡ŒéŒ¯èª¤ã—ãŸçµæœã€ãªã‚“ã¨ã‹å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚  

ã“ã‚Œã‚‰ã®çµŒé¨“ã‚’å…ƒã«ã€ã‚¼ãƒ­ãƒ™ãƒ¼ã‚¹ã§æ§‹ç¯‰æ–¹æ³•ãŒåˆ†ã‹ã‚‰ãšè‹¦åŠ´ã—ãŸå½“æ™‚ã®è‡ªåˆ†ã®ã‚ˆã†ãªäººã®ãŸã‚ã«ã€ã“ã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã—ãŸã€‚   

ç§è‡ªèº«ã€GitHub Actionsã®çŸ¥è­˜ãŒã»ã¼ãªã„çŠ¶æ…‹ã‹ã‚‰å­¦ã³ãªãŒã‚‰æ§‹ç¯‰ã—ã¾ã—ãŸã€‚  

ã“ã‚Œã‚‰ã®çµŒé¨“ã‚’å…ƒã«ã€**ã‚¼ãƒ­ãƒ™ãƒ¼ã‚¹ã§æ§‹ç¯‰æ–¹æ³•ãŒåˆ†ã‹ã‚‰ãšè‹¦åŠ´ã—ãŸå½“æ™‚ã®è‡ªåˆ†ã®ã‚ˆã†ãªäººã®ãŸã‚**ã«ã€ã“ã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã—ãŸã€‚
-->

<!-- 
å®Œå…¨ã«ã“ã¡ã‚‰ã®è¨˜äº‹[(çµå±€Githubã«å­¦ç¿’å±¥æ­´ã‚’çµ±ä¸€ã—ãŸæ–¹ãŒè«¸ã€…è‰¯ã‹ã£ãŸ)](https://zenn.dev/bun913/articles/study-history-on-github)ã®é€šã‚Šãªã®ã§ã€ãã®ã¾ã¾å¼•ç”¨ã•ã›ã¦é ‚ãã¾ã™ã€‚  

>ç§ã¯ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã‚’å¤§äº‹ã«ã—ãŸã„ã¨æ€ã„ã¤ã¤ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªæ‚©ã¿ã‚’æŒã£ã¦ãŠã‚Šã¾ã—ãŸã€‚
>
>- æ¯æ—¥ä½•ã‹ã—ã‚‰ã®å­¦ç¿’ã‚’ã—ã¦ã„ã‚‹ã®ã§ã€æ¯æ—¥å­¦ç¿’å±¥æ­´ã‚’æ®‹ã—ãŸã„
>- ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŸã‚‹ã‚‚ã®ã€ã©ã†ã›ãªã‚‰Github ã«è‰ã‚’ç”Ÿã‚„ã—ãŸã„
>- ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç³»ã®å­¦ç¿’ã¯ã—ã¦ã„ãªãã¦ã‚‚ã€èª­æ›¸ã—ãŸã‚Šè³‡æ ¼ã®å­¦ç¿’ã‚’ã—ã¦ã„ã‚‹æ—¥ãŒã‚ã‚‹ãŒã€Github ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã ã‘è¦‹ã‚‹ã¨ä½•ã‚‚ã—ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹
>- ã¾ãŸè³‡æ ¼å­¦ç¿’ã®ãŸã‚ã«å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦å‹‰å¼·ã—ã¦ã„ã‚‹ã‘ã©åŒã˜ãä½•ã‚‚å‹‰å¼·ã—ã¦ã„ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ -->

<!-- 
## ãªãœã“ã®è¨˜äº‹ã‚’æ›¸ã„ãŸã®ã‹ï¼Ÿ  

Notionã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã—ã¦é‹ç”¨ã•ã›ã‚‹è¨˜äº‹ã¯ã‚ã‚Œã©ã€å…·ä½“çš„ãªæ§‹ç¯‰æ–¹æ³•ã¾ã§è§£èª¬ã—ã¦ãã‚Œã¦ã„ã‚‹ã‚µã‚¤ãƒˆãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚(è‡ªåˆ†ãŒç„¡çŸ¥ãªã ã‘ã§ã€åˆ†ã‹ã‚‹äººãŒè¦‹ãŸã‚‰ãã‚Œã§ååˆ†ãªã®ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“)  
å‚è€ƒã‚µã‚¤ãƒˆã‚„AIã‚’é§†ä½¿ã—ãŸçµæœã€ãªã‚“ã¨ã‹å®Ÿç¾ã™ã‚‹äº‹ãŒå‡ºæ¥ãŸã®ã§ã€è‡ªåˆ†ã®ã‚ˆã†ã«ä½•ã®çŸ¥è­˜ã‚‚ãªã„äººã®å‚è€ƒã«ãªã‚Œã°ã¨æ€ã£ã¦æ›¸ãã¾ã—ãŸã€‚  
(æŠ€è¡“è¨˜äº‹ã®ãƒã‚¿ã«ã‚‚ãªã‚‹ã—â€¦)  
-->

<!-- ã“ã®æµã‚ŒãŒå®Ÿç¾ã§ããŸã‚‰ã€Œå®Œç’§ã ãªã€ã¨æ€ã„ã€æ–¹æ³•ã‚’èª¿ã¹å§‹ã‚ã¾ã—ãŸã€‚  
ã™ã‚‹ã¨ã€**ã¾ã•ã«æ±‚ã‚ã¦ã„ãŸä»•çµ„ã¿ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹äººãŸã¡ã‚’ç™ºè¦‹ï¼**  
æ„æ°—æšã€…ã¨å®Ÿè£…ã‚’è©¦ã¿ã¾ã—ãŸãŒã€æ€ã£ãŸä»¥ä¸Šã«é›£ã—ãã€ã™ãã«ã¯ç†è§£ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚   -->

<!-- 
å…ƒã€…ã€TILï¼ˆToday I Learnedï¼‰ã®å–ã‚Šçµ„ã¿ã‚’ã—ã¦ã„ã¾ã—ãŸãŒã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†ã‘ã‚‹æ–¹æ³•ã«é™ç•Œã‚’æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚  
ç‰¹ã«è¤‡æ•°ã®æŠ€è¡“ãŒé–¢ã‚ã‚‹å ´åˆã€ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚Œã°ã‚ˆã„ã®ã‹åˆ¤æ–­ã«è¿·ã†ã“ã¨ãŒå¤šã‹ã£ãŸã®ã§ã™ã€‚  
ä¾‹ãˆã°ã€ã€ŒC#ã§EFCoreã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã‚’ã™ã‚‹ã€ã¨ã„ã†è¨˜äº‹ã‚’æ›¸ã„ãŸå ´åˆã€C#ï¼Ÿ EFCoreï¼Ÿ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼Ÿ ã©ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæœ€é©ãªã®ã‹æ±ºã‚ã‹ã­ã‚‹ã€ã¨ã„ã£ãŸå…·åˆã§ã™ã€‚  

ä½•ã‹è‰¯ã„æ–¹æ³•ã¯ãªã„ã‹ã¨æ¨¡ç´¢ã—ã¦ã„ãŸã¨ã“ã‚ã€Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã€ã‚¿ã‚°ã‚’ä½¿ã£ã¦æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹æ–¹æ³•ã‚’æ€ã„ã¤ãã¾ã—ãŸã€‚  
å®Ÿéš›ã«Notionã§ã‚ã‚‹ç¨‹åº¦ã®ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã—ã€é‹ç”¨ã‚’å§‹ã‚ã¦ã¿ãŸã®ã§ã™ãŒã€ä¸€ã¤å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚  
**å­¦ç¿’è¨˜éŒ²ã¯Notionã«è“„ç©ã•ã‚Œã‚‹ã‚‚ã®ã®ã€GitHubã«ã¯åæ˜ ã•ã‚Œãªã„**ãŸã‚ã€ã›ã£ã‹ãã®å­¦ç¿’æˆæœãŒå½¢ã¨ã—ã¦æ®‹ã‚‰ãªã„ã®ãŒã‚‚ã£ãŸã„ãªã„ã¨æ„Ÿã˜ãŸã®ã§ã™ã€‚   -->

<!-- 
æ¦‚è¦

ã“ã®è¨˜äº‹ã§ã¯ã€GitHub Actionsã‚’åˆ©ç”¨ã—ã¦ã€Notionã®ãƒ‡ãƒ¼ã‚¿ã‚’Markdownå½¢å¼ã§æŠ½å‡ºã—ã€GitHubã«è‡ªå‹•çš„ã«åæ˜ ã•ã›ã‚‹ä»•çµ„ã¿ã®æ§‹ç¯‰æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚ 
-->

<!--
## ãƒ¡ãƒ¢

Notion ã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMS ã¨ã—ã¦æ´»ç”¨ã—ã€è¨˜äº‹ã‚’ GitHub ã«è‡ªå‹•ã§åæ˜ ã•ã›ã‚‹ä»•çµ„ã¿ã‚’æ§‹ç¯‰ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚  

![1000006240](https://github.com/user-attachments/assets/0309ead8-d6db-4ae4-846f-ce9bf8193e0d)

## ãã‚‚ãã‚‚Notionã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã—ã¦ä½¿ã†ã¨ã¯ï¼Ÿ  

æ™®é€šã®CMSï¼ˆWordPressãªã©ï¼‰ã¨é•ã„ã€Notionã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã—ã¦ä½¿ã†å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ãªä»•çµ„ã¿ã«ãªã‚Šã¾ã™ã€‚  

1. Notionã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«è¨˜äº‹ã‚’ä½œæˆ  
2. APIã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—  
3. å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’Markdownã«å¤‰æ›  
4. GitHub Actionsã§å®šæœŸçš„ã«å–å¾—ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤  

ã“ã®æµã‚Œã‚’å®Ÿç¾ã™ã‚‹ã¨ã€**Notionã§è¨˜äº‹ã‚’ç®¡ç†ã—ãªãŒã‚‰ã€è‡ªå‹•çš„ã«GitHubã«Markdownã¨ã—ã¦ä¿å­˜ã™ã‚‹** ã“ã¨ãŒã§ãã¾ã™ã€‚  


- **Notion**ï¼ˆè¨˜äº‹ã‚’ç®¡ç†ã™ã‚‹CMSä»£ã‚ã‚Šï¼‰  
- **Notion API**ï¼ˆNotionã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ï¼‰  
- **GitHub & GitHub Actions**ï¼ˆè¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’Markdownã«å¤‰æ›ã—ç®¡ç†ã™ã‚‹ï¼‰  
- **C#**ï¼ˆAPIã¨é€£æºã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆï¼‰   


## ã¾ã¨ã‚  

- Notionã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹CMSã¨ã—ã¦æ´»ç”¨ã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆ  
- å®Ÿè£…ã®æµã‚Œã‚’ãŠã•ã‚‰ã„  
- ä»Šå¾Œã®æ”¹å–„ç‚¹ã‚„ç™ºå±•çš„ãªä½¿ã„æ–¹  

### ğŸ¯ ã“ã‚“ãªäººã«å½¹ç«‹ã¤è¨˜äº‹  

- **Notionã‚’CMSã¨ã—ã¦ä½¿ã„ãŸã„ãŒã€æ§‹ç¯‰æ–¹æ³•ãŒåˆ†ã‹ã‚‰ãªã„äºº**  
- **GitHub Actionsã§Notionã®è¨˜äº‹ã‚’è‡ªå‹•ç®¡ç†ã—ãŸã„äºº**  
- **å®Ÿéš›ã«å‹•ãã‚µãƒ³ãƒ—ãƒ«ã‚’è©¦ã—ã¦ã¿ãŸã„äºº**  

-->